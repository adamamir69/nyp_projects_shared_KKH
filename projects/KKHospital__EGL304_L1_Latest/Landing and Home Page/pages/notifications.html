<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Notifications</title>
    <link rel="stylesheet" href="/index.css">
</head>

<body>
    <header class="topbar">
        <div class="notifications-page">
            <h2>Notifications</h2>
        </div>
    </header>

    <main class="main-content">
        <button id="mark-all-read-btn" class="btn-save">Mark All as Read</button>
        <div id="notifications-list" class="notifications-container"></div>
        <button onclick="window.history.back()" class="action-btn">‚Üê Back</button>
    </main>

    <script>
        async function loadNotificationsPage() {
            const res = await fetch("/notifications");
            const data = await res.json();

            const container = document.getElementById("notifications-list");
            container.innerHTML = "";

            if (!data.notifications.length) {
                container.innerHTML = "<p>No notifications.</p>";
                return;
            }

            data.notifications.forEach(n => {
                const div = document.createElement("div");
                div.className = `notif-item ${n.read ? "read" : "unread"}`;

                div.innerHTML = `
                    <div class="notif-content">
                        <p class="notif-msg">${n.message}</p>
                        <span class="notif-time">${new Date(n.timestamp).toLocaleString()}</span>
                    </div>
                    <div class="notif-actions">
                        <button class="mark-read-btn" ${n.read ? "disabled" : ""}>Mark as Read</button>
                        <button class="delete-btn">Delete</button>
                    </div>
                `;

                // Mark as read
                div.querySelector(".mark-read-btn").addEventListener("click", async () => {
                    await fetch("/notifications/read", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ id: n.id })
                    });
                    loadNotificationsPage();
                });

                // Delete
                div.querySelector(".delete-btn").addEventListener("click", async () => {
                    await fetch("/notifications/delete", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ id: n.id })
                    });
                    loadNotificationsPage();
                });

                container.appendChild(div);
            });
        }

        // Mark all as read
        document.getElementById("mark-all-read-btn").addEventListener("click", async () => {
            await fetch("/notifications/read-all", { method: "POST" });
            loadNotificationsPage();
        });

        document.addEventListener("DOMContentLoaded", loadNotificationsPage);
    </script>
</body>

</html>